Effect={};Effect2=Effect;Effect.Transitions={};Effect.Transitions.linear=function(pos){return pos;};Effect.Transitions.sinoidal=function(pos){return(-Math.cos(pos*Math.PI)/2)+0.5;};Effect.Transitions.reverse=function(pos){return 1-pos;};Effect.Transitions.flicker=function(pos){return((-Math.cos(pos*Math.PI)/4)+0.75)+Math.random(0.25);};Effect.Transitions.wobble=function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+0.5;};Effect.Transitions.pulse=function(pos){return(Math.floor(pos*10)%2==0?(pos*10-Math.floor(pos*10)):1-(pos*10-Math.floor(pos*10)));};Effect.Transitions.none=function(pos){return 0;};Effect.Transitions.full=function(pos){return 1;};Element.makePositioned=function(element){element=$(element);if(element.style.position=="")element.style.position="relative";};Element.makeClipping=function(element){element=$(element);element._overflow=element.style.overflow||'visible';if(element._overflow!='hidden')element.style.overflow='hidden';};Element.undoClipping=function(element){element=$(element);if(element._overflow!='hidden')element.style.overflow=element._overflow;};Effect.Base=function(){};Effect.Base.prototype={setOptions:function(options){this.options=Object.extend({transition:Effect.Transitions.sinoidal,duration:1.0,fps:25.0,sync:false,from:0.0,to:1.0},options||{});},start:function(options){this.setOptions(options||{});this.currentFrame=0;this.startOn=new Date().getTime();this.finishOn=this.startOn+(this.options.duration*1000);if(this.options.beforeStart)this.options.beforeStart(this);if(!this.options.sync)this.loop();},loop:function(){var timePos=new Date().getTime();if(timePos>=this.finishOn){this.render(1.0);if(this.finish)this.finish();if(this.options.afterFinish)this.options.afterFinish(this);return;}var pos=(timePos-this.startOn)/(this.finishOn-this.startOn);var frame=Math.round(pos*this.options.fps*this.options.duration);if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;};this.timeout=setTimeout(this.loop.bind(this),10);},render:function(pos){if(this.options.transition)pos=this.options.transition(pos);pos*=(this.options.to-this.options.from);pos+=this.options.from;if(this.options.beforeUpdate)this.options.beforeUpdate(this);if(this.update)this.update(pos);if(this.options.afterUpdate)this.options.afterUpdate(this);},cancel:function(){if(this.timeout)clearTimeout(this.timeout);}};Effect.Parallel=Class.create();Object.extend(Object.extend(Effect.Parallel.prototype,Effect.Base.prototype),{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){for(var i=0;i<this.effects.length;i++)this.effects[i].render(position);},finish:function(position){for(var i=0;i<this.effects.length;i++)if(this.effects[i].finish)this.effects[i].finish(position);}});Effect.Opacity=Class.create();Object.extend(Object.extend(Effect.Opacity.prototype,Effect.Base.prototype),{initialize:function(element){this.element=$(element);options=Object.extend({from:0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.setOpacity(position);},setOpacity:function(opacity){opacity=(opacity==1)?0.99999:opacity;this.element.style.opacity=opacity;this.element.style.filter="alpha(opacity:"+opacity*100+")";}});Effect.MoveBy=Class.create();Object.extend(Object.extend(Effect.MoveBy.prototype,Effect.Base.prototype),{initialize:function(element,toTop,toLeft){this.element=$(element);this.originalTop=parseFloat(this.element.style.top||'0');this.originalLeft=parseFloat(this.element.style.left||'0');this.toTop=toTop;this.toLeft=toLeft;Element.makePositioned(this.element);this.start(arguments[3]);},update:function(position){topd=this.toTop*position+this.originalTop;leftd=this.toLeft*position+this.originalLeft;this.setPosition(topd,leftd);},setPosition:function(topd,leftd){this.element.style.top=topd+"px";this.element.style.left=leftd+"px";}});Effect.Scale=Class.create();Object.extend(Object.extend(Effect.Scale.prototype,Effect.Base.prototype),{initialize:function(element,percent){this.element=$(element);options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0},arguments[2]||{});this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;if(this.element.style.fontSize=="")this.sizeEm=1.0;if(this.element.style.fontSize&&this.element.style.fontSize.indexOf("em")>0)this.sizeEm=parseFloat(this.element.style.fontSize);this.factor=(percent/100.0) - (options.scaleFrom/100.0);if(options.scaleMode=='box'){this.originalHeight=this.element.clientHeight;this.originalWidth=this.element.clientWidth;}else if(options.scaleMode=='contents'){this.originalHeight=this.element.scrollHeight;this.originalWidth=this.element.scrollWidth;}else{this.originalHeight=options.scaleMode.originalHeight;this.originalWidth=options.scaleMode.originalWidth;};this.start(options);},update:function(position){currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.sizeEm)this.element.style.fontSize=this.sizeEm*currentScale+"em";this.setDimensions(this.originalWidth*currentScale,this.originalHeight*currentScale);},setDimensions:function(width,height){if(this.options.scaleX)this.element.style.width=width+'px';if(this.options.scaleY)this.element.style.height=height+'px';if(this.options.scaleFromCenter){topd=(height-this.originalHeight)/2;leftd=(width-this.originalWidth)/2;if(this.element.style.position=='absolute'){if(this.options.scaleY)this.element.style.top=this.originalTop-topd+"px";if(this.options.scaleX)this.element.style.left=this.originalLeft-leftd+"px";}else{if(this.options.scaleY)this.element.style.top=-topd+"px";if(this.options.scaleX)this.element.style.left=-leftd+"px";}}}});Effect.Highlight=Class.create();Object.extend(Object.extend(Effect.Highlight.prototype,Effect.Base.prototype),{initialize:function(element){this.element=$(element);var endcolor="#ffffff";var current=this.element.style.backgroundColor;if(current&&current.slice(0,4)=="rgb("){endcolor="#";var cols=current.slice(4,current.length-1).split(',');var i=0;do{endcolor+=parseInt(cols[i]).toColorPart()}while(++i<3);}var options=Object.extend({startcolor:"#ffff99",endcolor:endcolor,restorecolor:current},arguments[1]||{});this.colors_base=[parseInt(options.startcolor.slice(1,3),16),parseInt(options.startcolor.slice(3,5),16),parseInt(options.startcolor.slice(5),16)];this.colors_delta=[parseInt(options.endcolor.slice(1,3),16)-this.colors_base[0],parseInt(options.endcolor.slice(3,5),16)-this.colors_base[1],parseInt(options.endcolor.slice(5),16)-this.colors_base[2]];this.start(options);},update:function(position){var colors=[Math.round(this.colors_base[0]+(this.colors_delta[0]*position)),Math.round(this.colors_base[1]+(this.colors_delta[1]*position)),Math.round(this.colors_base[2]+(this.colors_delta[2]*position))];this.element.style.backgroundColor="#"+colors[0].toColorPart()+colors[1].toColorPart()+colors[2].toColorPart();},finish:function(){this.element.style.backgroundColor=this.options.restorecolor;}});Effect.ScrollTo=Class.create();Object.extend(Object.extend(Effect.ScrollTo.prototype,Effect.Base.prototype),{initialize:function(element){this.element=$(element);Position.prepare();var offsets=Position.cumulativeOffset(this.element);var max=window.innerHeight?window.height-window.innerHeight:document.body.scrollHeight-(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight);this.scrollStart=Position.deltaY;this.delta=(offsets[1]>max?max:offsets[1])-this.scrollStart;this.start(arguments[1]||{});},update:function(position){Position.prepare();window.scrollTo(Position.deltaX,this.scrollStart+(position*this.delta));}});Effect.Fade=function(element){options=Object.extend({from:1.0,to:0.0,afterFinish:function(effect){Element.hide(effect.element);effect.setOpacity(1);}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){options=Object.extend({from:0.0,to:1.0,beforeStart:function(effect){effect.setOpacity(0);Element.show(effect.element);},afterUpdate:function(effect){Element.show(effect.element);}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true}),new Effect.Opacity(element,{sync:true,to:0.0,from:1.0})],{duration:1.0,afterUpdate:function(effect){effect.effects[0].element.style.position='absolute';},afterFinish:function(effect){Element.hide(effect.effects[0].element);}});};Effect.BlindUp=function(element){Element.makeClipping(element);return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,afterFinish:function(effect){Element.hide(effect.element);Element.undoClipping(effect.element);}},arguments[1]||{}));};Effect.BlindDown=function(element){$(element).style.height='0px';Element.makeClipping(element);Element.show(element);return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleMode:'contents',scaleFrom:0,afterFinish:function(effect){Element.undoClipping(effect.element);}},arguments[1]||{}));};Effect.SwitchOff=function(element){return new Effect.Appear(element,{duration:0.4,transition:Effect.Transitions.flicker,afterFinish:function(effect){effect.element.style.overflow='hidden';new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,afterUpdate:function(effect){if(effect.element.style.position=="")effect.element.style.position='relative';},afterFinish:function(effect){Element.hide(effect.element);}})}});};Effect.DropOut=function(element){return new Effect.Parallel([new Effect.MoveBy(element,100,0,{sync:true}),new Effect.Opacity(element,{sync:true,to:0.0,from:1.0})],{duration:0.5,afterFinish:function(effect){Element.hide(effect.effects[0].element);}});};Effect.Shake=function(element){return new Effect.MoveBy(element,0,20,{duration:0.05,afterFinish:function(effect){new Effect.MoveBy(effect.element,0,-40,{duration:0.1,afterFinish:function(effect){new Effect.MoveBy(effect.element,0,40,{duration:0.1,afterFinish:function(effect){new Effect.MoveBy(effect.element,0,-40,{duration:0.1,afterFinish:function(effect){new Effect.MoveBy(effect.element,0,40,{duration:0.1,afterFinish:function(effect){new Effect.MoveBy(effect.element,0,-20,{duration:0.05,afterFinish:function(effect){}})}})}})}})}})}});};Effect.SlideDown=function(element){element=$(element);element.style.height='0px';Element.makeClipping(element);Element.cleanWhitespace(element);Element.makePositioned(element.firstChild);Element.show(element);return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleMode:'contents',scaleFrom:0,afterUpdate:function(effect){effect.element.firstChild.style.bottom=(effect.originalHeight-effect.element.clientHeight)+'px';},afterFinish:function(effect){Element.undoClipping(effect.element);}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element);Element.makeClipping(element);Element.cleanWhitespace(element);Element.makePositioned(element.firstChild);Element.show(element);return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,afterUpdate:function(effect){effect.element.firstChild.style.bottom=(effect.originalHeight-effect.element.clientHeight)+'px';},afterFinish:function(effect){Element.hide(effect.element);Element.undoClipping(effect.element);}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,0,{afterFinish:function(effect){Element.hide(effect.element);}});};Effect.Grow=function(element){element=$(element);var options=arguments[1]||{};var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;element.style.overflow='hidden';Element.show(element);var direction=options.direction||'center';var moveTransition=options.moveTransition||Effect.Transitions.sinoidal;var scaleTransition=options.scaleTransition||Effect.Transitions.sinoidal;var opacityTransition=options.opacityTransition||Effect.Transitions.full;var initialMoveX,initialMoveY;var moveX,moveY;switch(direction){case 'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case 'top-right':initialMoveX=originalWidth;initialMoveY=moveY=0;moveX=-originalWidth;break;case 'bottom-left':initialMoveX=moveX=0;initialMoveY=originalHeight;moveY=-originalHeight;break;case 'bottom-right':initialMoveX=originalWidth;initialMoveY=originalHeight;moveX=-originalWidth;moveY=-originalHeight;break;case 'center':initialMoveX=originalWidth/2;initialMoveY=originalHeight/2;moveX=-originalWidth/2;moveY=-originalHeight/2;break;}return new Effect.MoveBy(element,initialMoveY,initialMoveX,{duration:0.01,beforeUpdate:function(effect){$(element).style.height='0px';},afterFinish:function(effect){new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:1.0,from:0.0,transition:opacityTransition}),new Effect.MoveBy(element,moveY,moveX,{sync:true,transition:moveTransition}),new Effect.Scale(element,100,{scaleMode:{originalHeight:originalHeight,originalWidth:originalWidth},sync:true,scaleFrom:0,scaleTo:100,transition:scaleTransition})],options);}});};Effect.Shrink=function(element){element=$(element);var options=arguments[1]||{};var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;element.style.overflow='hidden';Element.show(element);var direction=options.direction||'center';var moveTransition=options.moveTransition||Effect.Transitions.sinoidal;var scaleTransition=options.scaleTransition||Effect.Transitions.sinoidal;var opacityTransition=options.opacityTransition||Effect.Transitions.none;var moveX,moveY;switch(direction){case 'top-left':moveX=moveY=0;break;case 'top-right':moveX=originalWidth;moveY=0;break;case 'bottom-left':moveX=0;moveY=originalHeight;break;case 'bottom-right':moveX=originalWidth;moveY=originalHeight;break;case 'center':moveX=originalWidth/2;moveY=originalHeight/2;break;}return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:opacityTransition}),new Effect.Scale(element,0,{sync:true,transition:moveTransition}),new Effect.MoveBy(element,moveY,moveX,{sync:true,transition:scaleTransition})],options);};Effect.Pulsate=function(element){var options=arguments[1]||{};var transition=options.transition||Effect.Transitions.sinoidal;var reverser=function(pos){return transition(1-Effect.Transitions.pulse(pos))};reverser.bind(transition);return new Effect.Opacity(element,Object.extend(Object.extend({duration:3.0,afterFinish:function(effect){Element.show(effect.element);}},options),{transition:reverser}));};Effect.Fold=function(element){$(element).style.overflow='hidden';return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleTo:100,scaleX:false,afterFinish:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleTo:0,scaleY:false,afterFinish:function(effect){Element.hide(effect.element)}});}},arguments[1]||{}));};Element.setContentZoom=function(element,percent){var element=$(element);element.style.fontSize=(percent/100)+"em";if(navigator.appVersion.indexOf('AppleWebKit')>0)window.scrollBy(0,0);};Element.Class={toggle:function(element,className){if(Element.Class.has(element,className)){Element.Class.remove(element,className);if(arguments.length==3)Element.Class.add(element,arguments[2]);}else{Element.Class.add(element,className);if(arguments.length==3)Element.Class.remove(element,arguments[2]);}},get:function(element){element=$(element);return element.className.split(' ');},remove:function(element){element=$(element);var regEx;for(var i=1;i<arguments.length;i++){regEx=new RegExp("^"+arguments[i]+"\\b\\s*|\\s*\\b"+arguments[i]+"\\b",'g');element.className=element.className.replace(regEx,'')}},add:function(element){element=$(element);for(var i=1;i<arguments.length;i++){Element.Class.remove(element,arguments[i]);element.className+=(element.className.length>0?' ':'')+arguments[i];}},has:function(element){element=$(element);if(!element||!element.className)return false;var regEx;for(var i=1;i<arguments.length;i++){regEx=new RegExp("\\b"+arguments[i]+"\\b");if(!regEx.test(element.className))return false;};return true;},has_any:function(element){element=$(element);if(!element||!element.className)return false;var regEx;for(var i=1;i<arguments.length;i++){if((typeof arguments[i]=='object')&&(arguments[i].constructor==Array)){for(var j=0;j<arguments[i].length;j++){regEx=new RegExp("\\b"+arguments[i][j]+"\\b");if(regEx.test(element.className))return true;}}else{regEx=new RegExp("\\b"+arguments[i]+"\\b");if(regEx.test(element.className))return true;}};return false;},childrenWith:function(element,className){var children=$(element).getElementsByTagName('*');var elements=new Array();for(var i=0;i<children.length;i++){if(Element.Class.has(children[i],className)){elements.push(children[i]);break;}};return elements;}};var Droppables={drops:false,remove:function(element){for(var i=0;i<this.drops.length;i++)if(this.drops[i].element==element)this.drops.splice(i,1);},add:function(element){var element=$(element);var options=Object.extend({greedy:true,hoverclass:null},arguments[1]||{});if(options.containment){options._containers=new Array();var containment=options.containment;if((typeof containment=='object')&&(containment.constructor==Array)){for(var i=0;i<containment.length;i++)options._containers.push($(containment[i]));}else{options._containers.push($(containment));};options._containers_length=options._containers.length-1;};Element.makePositioned(element);options.element=element;if(!this.drops)this.drops=[];this.drops.push(options);},is_contained:function(element,drop){var containers=drop._containers;var parentNode=element.parentNode;var i=drop._containers_length;do{if(parentNode==containers[i])return true;}while(i--);return false;},is_affected:function(pX,pY,element,drop){return((drop.element!=element)&&((!drop._containers)||this.is_contained(element,drop))&&((!drop.accept)||(Element.Class.has_any(element,drop.accept)))&&Position.within(drop.element,pX,pY));},deactivate:function(drop){Element.Class.remove(drop.element,drop.hoverclass);this.last_active=null;},activate:function(drop){if(this.last_active)this.deactivate(this.last_active);if(drop.hoverclass){Element.Class.add(drop.element,drop.hoverclass);this.last_active=drop;}},show:function(event,element){if(!this.drops)return;var pX=Event.pointerX(event);var pY=Event.pointerY(event);Position.prepare();var i=this.drops.length-1;do{var drop=this.drops[i];if(this.is_affected(pX,pY,element,drop)){if(drop.onHover)drop.onHover(element,drop.element,Position.overlap(drop.overlap,drop.element));if(drop.greedy){this.activate(drop);return;}}}while(i--);},fire:function(event,element){if(!this.last_active)return;Position.prepare();if(this.is_affected(Event.pointerX(event),Event.pointerY(event),element,this.last_active))if(this.last_active.onDrop)this.last_active.onDrop(element,this.last_active);},reset:function(){if(this.last_active)this.deactivate(this.last_active);}};Draggables={observers:new Array(),addObserver:function(observer){this.observers.push(observer);},removeObserver:function(element){for(var i=0;i<this.observers.length;i++)if(this.observers[i].element&&(this.observers[i].element==element))this.observers.splice(i,1);},notify:function(eventName,draggable){for(var i=0;i<this.observers.length;i++)this.observers[i][eventName](draggable);}};Draggable=Class.create();Draggable.prototype={initialize:function(element){var options=Object.extend({handle:false,starteffect:function(element){new Effect.Opacity(element,{duration:0.2,from:1.0,to:0.7});},reverteffect:function(element,top_offset,left_offset){new Effect.MoveBy(element,-top_offset,-left_offset,{duration:0.4});},endeffect:function(element){new Effect.Opacity(element,{duration:0.2,from:0.7,to:1.0});},zindex:1000,revert:false},arguments[1]||{});this.element=$(element);this.handle=options.handle?$(options.handle):this.element;Element.makePositioned(this.element);this.offsetX=0;this.offsetY=0;this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();this.originalX=this.element.offsetLeft;this.originalY=this.element.offsetTop;this.originalZ=parseInt(this.element.style.zIndex||"0");this.options=options;this.active=false;this.dragging=false;this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);},currentLeft:function(){return parseInt(this.element.style.left||'0');},currentTop:function(){return parseInt(this.element.style.top||'0')},startDrag:function(event){if(Event.isLeftClick(event)){this.active=true;var style=this.element.style;this.originalY=this.element.offsetTop-this.currentTop()-this.originalTop;this.originalX=this.element.offsetLeft-this.currentLeft()-this.originalLeft;this.offsetY=event.clientY-this.originalY-this.originalTop;this.offsetX=event.clientX-this.originalX-this.originalLeft;Event.stop(event);}},finishDrag:function(event,success){this.active=false;this.dragging=false;if(success)Droppables.fire(event,this.element);Draggables.notify('onEnd',this);var revert=this.options.revert;if(revert&&typeof revert=='function')revert=revert(this.element);if(revert&&this.options.reverteffect){this.options.reverteffect(this.element,this.currentTop()-this.originalTop,this.currentLeft()-this.originalLeft);}else{this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();};this.element.style.zIndex=this.originalZ;if(this.options.endeffect)this.options.endeffect(this.element);Droppables.reset();},keyPress:function(event){if(this.active){if(event.keyCode==Event.KEY_ESC){this.finishDrag(event,false);Event.stop(event);}}},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);Event.stop(event);};this.active=false;this.dragging=false;},draw:function(event){var style=this.element.style;this.originalX=this.element.offsetLeft-this.currentLeft()-this.originalLeft;this.originalY=this.element.offsetTop-this.currentTop()-this.originalTop;if((!this.options.constraint)||(this.options.constraint=='horizontal'))style.left=((event.clientX-this.originalX)-this.offsetX)+"px";if((!this.options.constraint)||(this.options.constraint=='vertical'))style.top=((event.clientY-this.originalY)-this.offsetY)+"px";if(style.visibility=="hidden")style.visibility="";},update:function(event){if(this.active){if(!this.dragging){var style=this.element.style;this.dragging=true;if(style.position=="")style.position="relative";style.zIndex=this.options.zindex;Draggables.notify('onStart',this);if(this.options.starteffect)this.options.starteffect(this.element);};Droppables.show(event,this.element);this.draw(event);if(this.options.change)this.options.change(this);if(navigator.appVersion.indexOf('AppleWebKit')>0)window.scrollBy(0,0);Event.stop(event);}}};SortableObserver=Class.create();SortableObserver.prototype={initialize:function(element,observer){this.element=$(element);this.observer=observer;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){if(this.lastValue!=Sortable.serialize(this.element))this.observer(this.element)}};Sortable={sortables:new Array(),options:function(element){var element=$(element);for(var i=0;i<this.sortables.length;i++)if(this.sortables[i].element==element)return this.sortables[i];return null;},destroy:function(element){var element=$(element);for(var i=0;i<this.sortables.length;i++){if(this.sortables[i].element==element){var s=this.sortables[i];Draggables.removeObserver(s.element);for(var j=0;j<s.droppables.length;j++)Droppables.remove(s.droppables[j]);for(var j=0;j<s.draggables.length;j++)s.draggables[j].destroy();this.sortables.splice(i,1);}}},create:function(element){var element=$(element);var options=Object.extend({element:element,tag:'li',overlap:'vertical',constraint:'vertical',containment:element,handle:false,only:false,hoverclass:null,onChange:function(){},onUpdate:function(){}},arguments[1]||{});this.destroy(element);var options_for_draggable={revert:true,constraint:options.constraint,handle:handle};if(options.starteffect)options_for_draggable.starteffect=options.starteffect;if(options.reverteffect)options_for_draggable.reverteffect=options.reverteffect;if(options.endeffect)options_for_draggable.endeffect=options.endeffect;if(options.zindex)options_for_draggable.zindex=options.zindex;var options_for_droppable={overlap:options.overlap,containment:options.containment,hoverclass:options.hoverclass,onHover:function(element,dropon,overlap){if(overlap>0.5){if(dropon.previousSibling!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,dropon);if(dropon.parentNode!=oldParentNode&&oldParentNode.sortable)oldParentNode.sortable.onChange(element);if(dropon.parentNode.sortable)dropon.parentNode.sortable.onChange(element);}}else{var nextElement=dropon.nextSibling||null;if(nextElement!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,nextElement);if(dropon.parentNode!=oldParentNode&&oldParentNode.sortable)oldParentNode.sortable.onChange(element);if(dropon.parentNode.sortable)dropon.parentNode.sortable.onChange(element);}}}};Element.cleanWhitespace(element);options.draggables=[];options.droppables=[];var elements=element.childNodes;for(var i=0;i<elements.length;i++)if(elements[i].tagName&&elements[i].tagName==options.tag.toUpperCase()&&(!options.only||(Element.Class.has(elements[i],options.only)))){var handle=options.handle?Element.Class.childrenWith(elements[i],options.handle)[0]:elements[i];options.draggables.push(new Draggable(elements[i],Object.extend(options_for_draggable,{handle:handle})));Droppables.add(elements[i],options_for_droppable);options.droppables.push(elements[i]);};this.sortables.push(options);Draggables.addObserver(new SortableObserver(element,options.onUpdate));},serialize:function(element){var element=$(element);var sortableOptions=this.options(element);var options=Object.extend({tag:sortableOptions.tag,only:sortableOptions.only,name:element.id},arguments[1]||{});var items=$(element).childNodes;var queryComponents=new Array();for(var i=0;i<items.length;i++)if(items[i].tagName&&items[i].tagName==options.tag.toUpperCase()&&(!options.only||(Element.Class.has(items[i],options.only))))queryComponents.push(encodeURIComponent(options.name)+"[]="+encodeURIComponent(items[i].id.split("_")[1]));return queryComponents.join("&");}};Element.collectTextNodesIgnoreClass=function(element,ignoreclass){var children=$(element).childNodes;var text="";var classtest=new RegExp("^([^ ]+ )*"+ignoreclass+"( [^ ]+)*$","i");for(var i=0;i<children.length;i++){if(children[i].nodeType==3){text+=children[i].nodeValue;}else{if((!children[i].className.match(classtest))&&children[i].hasChildNodes())text+=Element.collectTextNodesIgnoreClass(children[i],ignoreclass);}};return text;};var Autocompleter={};Autocompleter.Base=function(){};Autocompleter.Base.prototype={base_initialize:function(element,update,options){this.element=$(element);this.update=$(update);this.has_focus=false;this.changed=false;this.active=false;this.index=0;this.entry_count=0;if(this.setOptions)this.setOptions(options);elsethis.options=options||{};this.options.tokens=this.options.tokens||new Array();this.options.frequency=this.options.frequency||0.4;this.options.min_chars=this.options.min_chars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';var offsets=Position.cumulativeOffset(element);update.style.left=offsets[0]+'px';update.style.top=(offsets[1]+element.offsetHeight)+'px';update.style.width=element.offsetWidth+'px';};new Effect.Appear(update,{duration:0.15});};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.15})};if(this.options.indicator)this.indicator=$(this.options.indicator);if(typeof(this.options.tokens)=='string')this.options.tokens=new Array(this.options.tokens);this.observer=null;Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keypress",this.onKeyPress.bindAsEventListener(this));},show:function(){if(this.update.style.display=='none')this.options.onShow(this.element,this.update);if(!this.iefix&&(navigator.appVersion.indexOf('MSIE')>0)&&this.update.style.position=='absolute'){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+'_iefix');};if(this.iefix){Position.clone(this.update,this.iefix);this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix);}},hide:function(){if(this.update.style.display=='')this.options.onHide(this.element,this.update);if(this.iefix)Element.hide(this.iefix);},startIndicator:function(){if(this.indicator)Element.show(this.indicator);},stopIndicator:function(){if(this.indicator)Element.hide(this.indicator);},onKeyPress:function(event){if(this.active)switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.select_entry();Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.mark_previous();this.render();if(navigator.appVersion.indexOf('AppleWebKit')>0)Event.stop(event);return;case Event.KEY_DOWN:this.mark_next();this.render();if(navigator.appVersion.indexOf('AppleWebKit')>0)Event.stop(event);return;}else if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN)return;this.changed=true;this.has_focus=true;if(this.observer)clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},onHover:function(event){var element=Event.findElement(event,'LI');if(this.index!=element.autocompleteIndex){this.index=element.autocompleteIndex;this.render();};Event.stop(event);},onClick:function(event){var element=Event.findElement(event,'LI');this.index=element.autocompleteIndex;this.select_entry();Event.stop(event);},onBlur:function(event){setTimeout(this.hide.bind(this),250);this.has_focus=false;this.active=false;},render:function(){if(this.entry_count>0){for(var i=0;i<this.entry_count;i++)this.index==i?Element.addClassName(this.get_entry(i),"selected"):Element.removeClassName(this.get_entry(i),"selected");if(this.has_focus){if(this.get_current_entry().scrollIntoView)this.get_current_entry().scrollIntoView(false);this.show();this.active=true;}}else this.hide();},mark_previous:function(){if(this.index>0)this.index--;else this.index=this.entry_count-1;},mark_next:function(){if(this.index<this.entry_count-1)this.index++;else this.index=0;},get_entry:function(index){return this.update.firstChild.childNodes[index];},get_current_entry:function(){return this.get_entry(this.index);},select_entry:function(){this.active=false;value=Element.collectTextNodesIgnoreClass(this.get_current_entry(),'informal').unescapeHTML();this.updateElement(value);this.element.focus();},updateElement:function(value){var last_token_pos=this.findLastToken();if(last_token_pos!=-1){var new_value=this.element.value.substr(0,last_token_pos+1);var whitespace=this.element.value.substr(last_token_pos+1).match(/^\s+/);if(whitespace)new_value+=whitespace[0];this.element.value=new_value+value;}else{this.element.value=value;}},updateChoices:function(choices){if(!this.changed&&this.has_focus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.firstChild);if(this.update.firstChild&&this.update.firstChild.childNodes){this.entry_count=this.update.firstChild.childNodes.length;for(var i=0;i<this.entry_count;i++){entry=this.get_entry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entry_count=0;};this.stopIndicator();this.index=0;this.render();}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this));},onObserverEvent:function(){this.changed=false;if(this.getEntry().length>=this.options.min_chars){this.startIndicator();this.getUpdatedChoices();}else{this.active=false;this.hide();}},getEntry:function(){var token_pos=this.findLastToken();if(token_pos!=-1){var ret=this.element.value.substr(token_pos+1).replace(/^\s+/,'').replace(/\s+$/,'');}else{var ret=this.element.value;};return/\n/.test(ret)?'':ret;},findLastToken:function(){var last_token_pos=-1;for(var i=0;i<this.options.tokens.length;i++){var this_token_pos=this.element.value.lastIndexOf(this.options.tokens[i]);if(this_token_pos>last_token_pos)last_token_pos=this_token_pos;};return last_token_pos;}};/*Ajax.Autocompleter=Class.create();Object.extend(Object.extend(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(element,update,url,options){this.base_initialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.method='post';this.options.defaultParams=this.options.parameters||null;this.url=url;},getUpdatedChoices:function(){entry=encodeURIComponent(this.element.name)+'='+encodeURIComponent(this.getEntry());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams)this.options.parameters+='&'+this.options.defaultParams;new Ajax.Request(this.url,this.options);},onComplete:function(request){this.updateChoices(request.responseText);}});*/Autocompleter.Local=Class.create();Autocompleter.Local.prototype=Object.extend(new Autocompleter.Base(),{initialize:function(element,update,array,options){this.base_initialize(element,update,options);this.options.array=array;},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this));},setOptions:function(options){this.options=Object.extend({choices:10,partial_search:true,partial_chars:2,ignore_case:true,full_search:false,selector:function(instance){var ret=new Array();var partial=new Array();var entry=instance.getEntry();var count=0;for(var i=0;i<instance.options.array.length&&ret.length<instance.options.choices;i++){var elem=instance.options.array[i];var found_pos=instance.options.ignore_case?elem.toLowerCase().indexOf(entry.toLowerCase()):elem.indexOf(entry);while(found_pos!=-1){if(found_pos==0&&elem.length!=entry.length){ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+elem.substr(entry.length)+"</li>");break;}else if(entry.length>=instance.options.partial_chars&&instance.options.partial_search&&found_pos!=-1){if(instance.options.full_search||/\s/.test(elem.substr(found_pos-1,1))){partial.push("<li>"+elem.substr(0,found_pos)+"<strong>"+elem.substr(found_pos,entry.length)+"</strong>"+elem.substr(found_pos+entry.length)+"</li>");break;}}found_pos=instance.options.ignore_case?elem.toLowerCase().indexOf(entry.toLowerCase(),found_pos+1):elem.indexOf(entry,found_pos+1);}}if(partial.length)ret=ret.concat(partial.slice(0,instance.options.choices-ret.length));return "<ul>"+ret.join('')+"</ul>";}},options||{});}});

